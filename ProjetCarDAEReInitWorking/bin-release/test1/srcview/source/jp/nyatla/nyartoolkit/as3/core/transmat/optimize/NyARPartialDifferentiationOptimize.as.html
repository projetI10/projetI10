<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>NyARPartialDifferentiationOptimize.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/* 
 * PROJECT: NyARToolkitAS3
 * --------------------------------------------------------------------------------
 * This work is based on the original ARToolKit developed by
 *   Hirokazu Kato
 *   Mark Billinghurst
 *   HITLab, University of Washington, Seattle
 * http://www.hitl.washington.edu/artoolkit/
 *
 * The NyARToolkitAS3 is AS3 edition ARToolKit class library.
 * Copyright (C)2010 Ryo Iizuka
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 * 
 * For further information please contact.
 *    http://nyatla.jp/nyatoolkit/
 *    &lt;airmail(at)ebony.plala.or.jp&gt; or &lt;nyatla(at)nyatla.jp&gt;
 * 
 */</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transmat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">optimize</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">types</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">param</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transmat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">solver</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">types</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptASDoc">/**
     * 基本姿勢と実画像を一致するように、角度を微調整→平行移動量を再計算 を繰り返して、変換行列を最適化する。
     * 
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">NyARPartialDifferentiationOptimize</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_projection_mat_ref</span>:<span class="ActionScriptDefault_Text">NyARPerspectiveProjectionMatrix</span>;

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">NyARPartialDifferentiationOptimize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_projection_mat_ref</span>:<span class="ActionScriptDefault_Text">NyARPerspectiveProjectionMatrix</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_projection_mat_ref</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_projection_mat_ref</span>;
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">sincos2Rotation_ZXY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_sincos</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_rot_matrix</span>:<span class="ActionScriptDefault_Text">NyARDoubleMatrix33</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sina</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_sincos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosa</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_sincos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinb</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_sincos</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosb</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_sincos</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinc</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_sincos</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosc</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_sincos</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m00</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m01</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m02</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m10</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m12</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m20</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m21</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sina</span>;
            <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">rotation2Sincos_ZXY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_rot_matrix</span>:<span class="ActionScriptDefault_Text">NyARDoubleMatrix33</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_out</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_ang</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">z</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sina</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m21</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">&gt;=</span> 1.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">/</span> 2;
                <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m10</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m00</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptOperator">-</span>1.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">/</span> 2;
                <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m10</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m00</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">asin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m20</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m22</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m01</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_rot_matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m11</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">o_ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">o_ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">o_ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">z</span>;
            <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">/*
         * 射影変換式 基本式 ox=(cosc * cosb - sinc * sina * sinb)*ix+(-sinc * cosa)*iy+(cosc * sinb + sinc * sina * cosb)*iz+i_trans.x; oy=(sinc * cosb + cosc * sina *
         * sinb)*ix+(cosc * cosa)*iy+(sinc * sinb - cosc * sina * cosb)*iz+i_trans.y; oz=(-cosa * sinb)*ix+(sina)*iy+(cosb * cosa)*iz+i_trans.z;
         * 
         * double ox=(cosc * cosb)*ix+(-sinc * sina * sinb)*ix+(-sinc * cosa)*iy+(cosc * sinb)*iz + (sinc * sina * cosb)*iz+i_trans.x; double oy=(sinc * cosb)*ix
         * +(cosc * sina * sinb)*ix+(cosc * cosa)*iy+(sinc * sinb)*iz+(- cosc * sina * cosb)*iz+i_trans.y; double oz=(-cosa * sinb)*ix+(sina)*iy+(cosb *
         * cosa)*iz+i_trans.z;
         * 
         * sina,cosaについて解く cx=(cp00*(-sinc*sinb*ix+sinc*cosb*iz)+cp01*(cosc*sinb*ix-cosc*cosb*iz)+cp02*(iy))*sina
         * +(cp00*(-sinc*iy)+cp01*((cosc*iy))+cp02*(-sinb*ix+cosb*iz))*cosa
         * +(cp00*(i_trans.x+cosc*cosb*ix+cosc*sinb*iz)+cp01*((i_trans.y+sinc*cosb*ix+sinc*sinb*iz))+cp02*(i_trans.z));
         * cy=(cp11*(cosc*sinb*ix-cosc*cosb*iz)+cp12*(iy))*sina +(cp11*((cosc*iy))+cp12*(-sinb*ix+cosb*iz))*cosa
         * +(cp11*((i_trans.y+sinc*cosb*ix+sinc*sinb*iz))+cp12*(i_trans.z)); ch=(iy)*sina +(-sinb*ix+cosb*iz)*cosa +i_trans.z; sinb,cosb hx=(cp00*(-sinc *
         * sina*ix+cosc*iz)+cp01*(cosc * sina*ix+sinc*iz)+cp02*(-cosa*ix))*sinb +(cp01*(sinc*ix-cosc * sina*iz)+cp00*(cosc*ix+sinc * sina*iz)+cp02*(cosa*iz))*cosb
         * +(cp00*(i_trans.x+(-sinc*cosa)*iy)+cp01*(i_trans.y+(cosc * cosa)*iy)+cp02*(i_trans.z+(sina)*iy)); double hy=(cp11*(cosc *
         * sina*ix+sinc*iz)+cp12*(-cosa*ix))*sinb +(cp11*(sinc*ix-cosc * sina*iz)+cp12*(cosa*iz))*cosb +(cp11*(i_trans.y+(cosc *
         * cosa)*iy)+cp12*(i_trans.z+(sina)*iy)); double h =((-cosa*ix)*sinb +(cosa*iz)*cosb +i_trans.z+(sina)*iy); パラメータ返還式 L=2*Σ(d[n]*e[n]+a[n]*b[n])
         * J=2*Σ(d[n]*f[n]+a[n]*c[n])/L K=2*Σ(-e[n]*f[n]+b[n]*c[n])/L M=Σ(-e[n]^2+d[n]^2-b[n]^2+a[n]^2)/L 偏微分式 +J*cos(x) +K*sin(x) -sin(x)^2 +cos(x)^2
         * +2*M*cos(x)*sin(x)
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">optimizeParamX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_angle_y</span>:<span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_angle_z</span>:<span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_trans</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex3d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex2d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_number_of_vertex</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_hint_angle</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp</span>:<span class="ActionScriptDefault_Text">NyARPerspectiveProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_projection_mat_ref</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinb</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosb</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinc</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_z</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosc</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_z</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">J</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">K</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">M</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">N</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">O</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">N</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">O</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">i_number_of_vertex</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ix</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">iy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">iz</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp00</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m00</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp01</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m01</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp02</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m02</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp11</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m11</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp12</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m12</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">b</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">f</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X0</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X2</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y0</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y2</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span>;
                <span class="ActionScriptDefault_Text">N</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">a</span>;
                <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;
                <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span>;
                <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;
                <span class="ActionScriptDefault_Text">O</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;

            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">*=</span>2;
            <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*=</span>2;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">*=</span>2;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">getMinimumErrorAngleFromParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">L</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">J</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">M</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">N</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">O</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_hint_angle</span><span class="ActionScriptBracket/Brace">)</span>;


        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">optimizeParamY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_angle_x</span>:<span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_angle_z</span>:<span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_trans</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex3d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex2d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_number_of_vertex</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_hint_angle</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp</span>:<span class="ActionScriptDefault_Text">NyARPerspectiveProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_projection_mat_ref</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sina</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_x</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosa</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_x</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinc</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_z</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosc</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_z</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">J</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">K</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">M</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">N</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">O</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">N</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">O</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">i_number_of_vertex</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ix</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">iy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">iz</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp00</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m00</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp01</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m01</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp02</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m02</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp11</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m11</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp12</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m12</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sinc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosc</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">b</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">f</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X0</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X2</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y0</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y2</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span>;
                <span class="ActionScriptDefault_Text">N</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">a</span>;
                <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;
                <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span>;
                <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;
                <span class="ActionScriptDefault_Text">O</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;

            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">*=</span> 2;
            <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*=</span> 2;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">*=</span> 2;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">getMinimumErrorAngleFromParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">L</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">J</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">M</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">N</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">O</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_hint_angle</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">optimizeParamZ</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_angle_x</span>:<span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_angle_y</span>:<span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_trans</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex3d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex2d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_number_of_vertex</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_hint_angle</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp</span>:<span class="ActionScriptDefault_Text">NyARPerspectiveProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_projection_mat_ref</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sina</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_x</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosa</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_x</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sinb</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cosb</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_angle_y</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos_val</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">J</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">K</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">M</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">N</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">O</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">N</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">O</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">i_number_of_vertex</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ix</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">iy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">iz</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp00</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m00</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp01</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m01</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp02</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m02</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp11</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m11</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp12</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m12</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">X2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp00</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp01</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp02</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sina</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosb</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Y2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">H2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cosa</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sinb</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ix</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sina</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cosb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cosa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">iz</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">b</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">f</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X0</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">X2</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y0</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">H2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Y2</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span>;
                <span class="ActionScriptDefault_Text">N</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">a</span>;
                <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;
                <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b</span>;
                <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;
                <span class="ActionScriptDefault_Text">O</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">c</span>;

            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">L</span> <span class="ActionScriptOperator">*=</span>2;
            <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*=</span>2;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">*=</span>2;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">getMinimumErrorAngleFromParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">L</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">J</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">M</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">N</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">O</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_hint_angle</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__angles_in</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">createArray</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__ang</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">modifyMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">io_rot</span>:<span class="ActionScriptDefault_Text">NyARDoubleMatrix33</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_trans</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex3d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint3d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex2d</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARDoublePoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_number_of_vertex</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">angles_in</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__angles_in</span>;<span class="ActionScriptComment">// x,y,z
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ang</span>:<span class="ActionScriptDefault_Text">NyARDoublePoint3d</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__ang</span>;

            <span class="ActionScriptComment">// ZXY系のsin/cos値を抽出
</span>            <span class="ActionScriptDefault_Text">rotation2Sincos_ZXY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">io_rot</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">optimizeParamX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_number_of_vertex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">optimizeParamY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_number_of_vertex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">optimizeParamZ</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angles_in</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_trans</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex3d</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_vertex2d</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_number_of_vertex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">io_rot</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setZXYAngle_Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ang</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__sin_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>4<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptASDoc">/**
         * エラーレートが最小になる点を得る。
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getMinimumErrorAngleFromParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iL</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">iJ</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">iK</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">iM</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">iN</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">iO</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_hint_angle</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iL</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MIN_VALUE</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> 0;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sin_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__sin_table</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">M</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iN</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">iM</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">iL</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">J</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">iJ</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">iL</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">K</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">iK</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">iL</span>;

            <span class="ActionScriptComment">// パラメータからsinテーブルを作成
</span>            <span class="ActionScriptComment">// (- 4*M^2-4)*x^4 + (4*K- 4*J*M)*x^3 + (4*M^2 -(K^2- 4)- J^2)*x^2 +(4*J*M- 2*K)*x + J^2-1 = 0
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">number_of_sin</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">NyAREquationSolver</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">solve4Equation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">-</span> 4<span class="ActionScriptOperator">,</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">-</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span><span class="ActionScriptOperator">,</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">-</span> 4<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">J</span><span class="ActionScriptOperator">,</span> 4 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">-</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">J</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">sin_table</span><span class="ActionScriptBracket/Brace">)</span>;


            <span class="ActionScriptComment">// 最小値２個を得ておく。
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">min_ang_0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">min_ang_1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">min_err_0</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">min_err_1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">number_of_sin</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// +-cos_v[i]が頂点候補
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sin_rt</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sin_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cos_rt</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sin_rt</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// cosを修復。微分式で0に近い方が正解
</span>                <span class="ActionScriptComment">// 0 = 2*cos(x)*sin(x)*M - sin(x)^2 + cos(x)^2 + sin(x)*K + cos(x)*J
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sin_rt</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">J</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 2 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cos_rt</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">M</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sin_rt</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cos_rt</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cos_rt</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">J</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// 絶対値になおして、真のcos値を得ておく。
</span>                <span class="ActionScriptDefault_Text">a1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">a1</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">a1</span> : <span class="ActionScriptDefault_Text">a1</span>;
                <span class="ActionScriptDefault_Text">a2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">a2</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">a2</span> : <span class="ActionScriptDefault_Text">a2</span>;
                <span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a1</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">a2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">cos_rt</span> : <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cos_rt</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ang</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sin_rt</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cos_rt</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// エラー値を計算
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">err</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">iN</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iL</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iJ</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sin_rt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iM</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iK</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cos_rt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iO</span>;
                <span class="ActionScriptComment">// 最小の２個を獲得する。
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">min_err_0</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">err</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">min_err_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">min_err_0</span>;
                    <span class="ActionScriptDefault_Text">min_ang_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">min_ang_0</span>;
                    <span class="ActionScriptDefault_Text">min_err_0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">err</span>;
                    <span class="ActionScriptDefault_Text">min_ang_0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ang</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">min_err_1</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">err</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">min_err_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">err</span>;
                    <span class="ActionScriptDefault_Text">min_ang_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ang</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// [0]をテスト
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gap_0</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">gap_0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">min_ang_0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_hint_angle</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gap_0</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">gap_0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">min_ang_0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_hint_angle</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gap_0</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">gap_0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">min_ang_0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_hint_angle</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// [1]をテスト
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gap_1</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">gap_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">min_ang_1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_hint_angle</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gap_1</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">gap_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">min_ang_1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_hint_angle</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gap_1</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">gap_1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">min_ang_1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_hint_angle</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gap_1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gap_0</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">gap_1</span> : <span class="ActionScriptDefault_Text">gap_0</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>


<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cos_val</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sin_val</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_size</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">result</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_size</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_size</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TSinCosValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">result</span>;
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
