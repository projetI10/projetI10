<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>NyIdMarkerPickup.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/* 
 * PROJECT: NyARToolkitAS3
 * --------------------------------------------------------------------------------
 * This work is based on the original ARToolKit developed by
 *   Hirokazu Kato
 *   Mark Billinghurst
 *   HITLab, University of Washington, Seattle
 * http://www.hitl.washington.edu/artoolkit/
 *
 * The NyARToolkitAS3 is AS3 edition ARToolKit class library.
 * Copyright (C)2010 Ryo Iizuka
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 * 
 * For further information please contact.
 *    http://nyatla.jp/nyatoolkit/
 *    &lt;airmail(at)ebony.plala.or.jp&gt; or &lt;nyatla(at)nyatla.jp&gt;
 * 
 */</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyidmarker</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">squaredetect</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">raster</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">raster</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rgb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rasterreader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">types</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;

    <span class="ActionScriptASDoc">/**
     * ラスタ画像の任意矩形から、NyARIdMarkerDataを抽出します。
     *
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">NyIdMarkerPickup</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_perspective_reader</span>:<span class="ActionScriptDefault_Text">PerspectivePixelReader</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__pickFromRaster_th</span>:<span class="ActionScriptDefault_Text">TThreshold</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TThreshold</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__pickFromRaster_encoder</span>:<span class="ActionScriptDefault_Text">MarkerPattEncoder</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MarkerPattEncoder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;


        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">NyIdMarkerPickup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_perspective_reader</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">PerspectivePixelReader</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * i_imageから、idマーカを読みだします。
         * o_dataにはマーカデータ、o_paramにはまーかのパラメータを返却します。
         * @param image
         * @param i_square
         * @param o_data
         * @param o_param
         * @return
         * @throws NyARException
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">pickFromRaster</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span>:<span class="ActionScriptDefault_Text">INyARRgbRaster</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_vertex</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_data</span>:<span class="ActionScriptDefault_Text">NyIdMarkerPattern</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_param</span>:<span class="ActionScriptDefault_Text">NyIdMarkerParam</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptComment">//遠近法のパラメータを計算
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_perspective_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSourceSquare</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_vertex</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getRgbPixelReader</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getSize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            


            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th</span>:<span class="ActionScriptDefault_Text">TThreshold</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__pickFromRaster_th</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">encoder</span>:<span class="ActionScriptDefault_Text">MarkerPattEncoder</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__pickFromRaster_encoder</span>;
            <span class="ActionScriptComment">//マーカパラメータを取得
</span>            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_perspective_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">detectThresholdValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_perspective_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">readDataBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">encoder</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">encoder</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">o_data</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">o_param</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">direction</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">d</span>;
            <span class="ActionScriptDefault_Text">o_param</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">threshold</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rasterreader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">types</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyidmarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">jp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyatla</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyartoolkit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">as3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">nyidmarker</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;

<span class="ActionScriptASDoc">/**
 * NyARColorPatt_NyIdMarkerがラスタからPerspective変換して読みだすためのクラス
 *
 */</span>
<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">PerspectivePixelReader</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_param_gen</span>:<span class="ActionScriptDefault_Text">NyARPerspectiveParamGenerator_O1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">NyARPerspectiveParamGenerator_O1</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span>100<span class="ActionScriptOperator">,</span>100<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_cparam</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>8<span class="ActionScriptBracket/Brace">)</span>;


    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">PerspectivePixelReader</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setSourceSquare</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_vertex</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_param_gen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_vertex</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_cparam</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * 矩形からピクセルを切り出します
     * @param i_lt_x
     * @param i_lt_y
     * @param i_step_x
     * @param i_step_y
     * @param i_width
     * @param i_height
     * @param i_out_st
     * o_pixelへの格納場所の先頭インデクス
     * @param o_pixel
     * @throws NyARException
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">rectPixels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_lt_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_lt_y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_step_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_step_y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_height</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_out_st</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_pixel</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_cparam</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pixcel_temp</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pixcel_temp</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">w</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_height</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">h</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">out_index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_out_st</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_6</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_3</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>;

        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_height</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//1列分のピクセルのインデックス値を計算する。
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy0</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_step_y</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_lt_y</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_12</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_45</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_7</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span>1.0;            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_width</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx0</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_step_x</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_lt_x</span>;                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_6</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_7</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpara_0</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpara_3</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_45</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">raster_width</span><span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">raster_height</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//1行分のピクセルを取得(場合によっては専用アクセサを書いた方がいい)
</span>            <span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixelSet</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_width</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//グレースケールにしながら、line→mapへの転写
</span>            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_width</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">o_pixel</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">out_index</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>3;
                <span class="ActionScriptDefault_Text">out_index</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>            
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
     * i_freqにあるゼロクロス点の周期が、等間隔か調べます。
     * 次段半周期が、前段の80%より大きく、120%未満であるものを、等間隔周期であるとみなします。
     * @param i_freq
     * @param i_width
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">checkFreqWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_freq</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_freq</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i_freq</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_width</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">count</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_freq</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">i_freq</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">*</span>100<span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">c</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">&gt;</span>150 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">&lt;</span>50<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">n</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
     * i_freq_count_tableとi_freq_tableの内容を調査し、最も大きな周波数成分を返します。
     * @param i_freq_count_table
     * @param i_freq_table
     * @param o_freq_table
     * @return
     * 見つかれば0以上、密辛ければ0未満
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getMaxFreq</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_freq_count_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_freq_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_freq_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//一番成分の大きいものを得る
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>-1;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">max</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">MAX_FREQ</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">max</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_freq_count_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptDefault_Text">max</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_freq_count_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>        
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">==</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">/*周波数インデクスを計算*/</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">st</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">index</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">*</span>2;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">o_freq_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_freq_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">st</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">FRQ_STEP</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">max</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">index</span>;
    <span class="ActionScriptBracket/Brace">}</span>
        
    
    <span class="ActionScriptComment">//タイミングパターン用のパラメタ(FRQ_POINTS*FRQ_STEPが100を超えないようにすること)
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">FRQ_EDGE</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>5;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">FRQ_STEP</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>2;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">FRQ_POINTS</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptOperator">-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">FRQ_STEP</span>;
    

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MIN_FREQ</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>3;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAX_FREQ</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>10;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">FREQ_SAMPLE_NUM</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>4;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">MAX_DATA_BITS</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptOperator">-</span>1;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ref_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>108<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ref_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>108<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptComment">//(model+1)*4*3とTHRESHOLD_PIXEL*3のどちらか大きい方
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pixcel_temp</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>108<span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">)</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_freq_count_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_freq_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptASDoc">/**
     * i_y1行目とi_y2行目を平均して、タイミングパターンの周波数を得ます。
     * LHLを1周期として、たとえばLHLHLの場合は2を返します。LHLHやHLHL等の始端と終端のレベルが異なるパターンを
     * 検出した場合、関数は失敗します。
     * 
     * @param i_y1
     * @param i_y2
     * @param i_th_h
     * @param i_th_l
     * @param o_edge_index
     * 検出したエッジ位置(H-&gt;L,L-&gt;H)のインデクスを受け取る配列です。
     * [FRQ_POINTS]以上の配列を指定してください。
     * @return
     * @throws NyARException
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getRowFrequency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_y1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_h</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_l</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptComment">//3,4,5,6,7,8,9,10
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_count_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_freq_count_table</span>;
        <span class="ActionScriptComment">//0,2,4,6,8,10,12,14,16,18,20の要素を持つ配列
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_freq_table</span>;
        <span class="ActionScriptComment">//初期化
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_cparam</span>;
<span class="ActionScriptComment">//        final INyARRgbPixelReader reader=this._raster.getRgbPixelReader();
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pixcel_temp</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pixcel_temp</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>10;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_count_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>110;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">w</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_height</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">h</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_3</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_6</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;        
        
        <span class="ActionScriptComment">//10-20ピクセル目からタイミングパターンを検出
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">FREQ_SAMPLE_NUM</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptComment">//2行分のピクセルインデックスを計算
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_y1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_12</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_45</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_7</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span>1.0;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">FRQ_STEP</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span>;            
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpara_6</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_7</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpara_0</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpara_3</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_45</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">raster_width</span><span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">raster_height</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//ピクセルを取得(入力画像を多様化するならここから先を調整すること)
</span>            <span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixelSet</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">//o_edge_indexを一時的に破壊して調査する
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_t</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getFreqInfo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_h</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_l</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">)</span>;            
            
            <span class="ActionScriptComment">//周期は3-10であること
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">MIN_FREQ</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">continue</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//周期は等間隔であること
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">checkFreqWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">continue</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//検出カウンタを追加
</span>            <span class="ActionScriptDefault_Text">freq_count_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">table_st</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">freq_t</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">*</span>2;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">freq_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">table_st</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">getMaxFreq</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_count_table</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_table</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getColFrequency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_x1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_h</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_l</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_cparam</span>;
<span class="ActionScriptComment">//        final INyARRgbPixelReader reader=this._raster.getRgbPixelReader();
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pixcel_temp</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pixcel_temp</span>;
        <span class="ActionScriptComment">//0,2,4,6,8,10,12,14,16,18,20=(11*20)/2=110
</span>        <span class="ActionScriptComment">//初期化
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_count_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_freq_count_table</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>10;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_count_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_freq_table</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span>110;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">w</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">raster_height</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">h</span>;
        
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara7</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara4</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptComment">//基準点から4ピクセルを参照パターンとして抽出
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">FREQ_SAMPLE_NUM</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">int</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx0</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_x1</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp6_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpx0_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpx3_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">FRQ_STEP</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cp6_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara7</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptOperator">+</span>1.0;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx0_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx3_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara4</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">raster_width</span><span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptDefault_Text">raster_height</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">y</span>;                
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>        
        
            <span class="ActionScriptComment">//ピクセルを取得(入力画像を多様化するならここを調整すること)
</span>            <span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixelSet</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_t</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getFreqInfo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_h</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_l</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//周期は3-10であること
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">MIN_FREQ</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">continue</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//周期は等間隔であること
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">checkFreqWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">continue</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//検出カウンタを追加
</span>            <span class="ActionScriptDefault_Text">freq_count_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">table_st</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">freq_t</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">freq_t</span><span class="ActionScriptOperator">*</span>2;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">freq_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">table_st</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">getMaxFreq</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_count_table</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_table</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">)</span>;        
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * デバックすんだらstaticにしておｋ
     * @param i_pixcels
     * @param i_th_h
     * @param i_th_l
     * @param o_edge_index
     * @return
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getFreqInfo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pixcels</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_h</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th_l</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_edge_index</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//トークンを解析して、周波数を計算
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">frq_l2h</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">frq_h2l</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">pix</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//L-&gt;Hトークンを検出する
</span>            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pixcels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_pixcels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_pixcels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>3;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">i_th_h</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//トークン発見
</span>                    <span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">frq_l2h</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">frq_h2l</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i</span>;
                    <span class="ActionScriptDefault_Text">frq_l2h</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptComment">//L-&gt;Hトークンを検出する
</span>            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pixcels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_pixcels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_pixcels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>3;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptOperator">&lt;=</span><span class="ActionScriptDefault_Text">i_th_l</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//トークン発見
</span>                    <span class="ActionScriptDefault_Text">o_edge_index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">frq_l2h</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">frq_h2l</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i</span>;
                    <span class="ActionScriptDefault_Text">frq_h2l</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">frq_l2h</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">frq_h2l</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">frq_l2h</span>:<span class="ActionScriptOperator">-</span>1;            
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_EDGE</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>10;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>2;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_WIDTH</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>10;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">THRESHOLD_WIDTH</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">THRESHOLD_EDGE</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>100<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">THRESHOLD_WIDTH</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">THRESHOLD_EDGE</span>;
    

    <span class="ActionScriptASDoc">/**
     * ピクセル配列の上位、下位の4ピクセルのピクセル値平均を求めます。
     * この関数は、(4/i_pixcel.length)の領域を占有するPtail法で双方向の閾値を求めることになります。
     * @param i_pixcel
     * @param i_initial
     * @param i_out
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getPtailHighAndLow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pixcel</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_out</span>:<span class="ActionScriptDefault_Text">THighAndLow</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">h3</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">h2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">h1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">h0</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">l3</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">l2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">l1</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">l0</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptDefault_Text">h3</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l3</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_pixcel</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_pixcel</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pix</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_pixcel</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">h1</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">h2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">h3</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h1</span>;
                            <span class="ActionScriptDefault_Text">h1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h2</span>;
                            <span class="ActionScriptDefault_Text">h2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h3</span>;
                            <span class="ActionScriptDefault_Text">h3</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h1</span>;
                            <span class="ActionScriptDefault_Text">h1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h2</span>;
                            <span class="ActionScriptDefault_Text">h2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">h1</span>;
                        <span class="ActionScriptDefault_Text">h1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l1</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l2</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l3</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">pix</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l1</span>;
                            <span class="ActionScriptDefault_Text">l1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l2</span>;
                            <span class="ActionScriptDefault_Text">l2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l3</span>;
                            <span class="ActionScriptDefault_Text">l3</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l1</span>;
                            <span class="ActionScriptDefault_Text">l1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l2</span>;
                            <span class="ActionScriptDefault_Text">l2</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">l1</span>;
                        <span class="ActionScriptDefault_Text">l1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pix</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">i_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">l1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">l2</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">l3</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>4;
        <span class="ActionScriptDefault_Text">i_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">h</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">h0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">h1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">h2</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">h3</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>4;
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__detectThresholdValue_hl</span>:<span class="ActionScriptDefault_Text">THighAndLow</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">THighAndLow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__detectThresholdValue_tpt</span>:<span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_th_pixels</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">*</span>4<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptASDoc">/**
     * 指定した場所のピクセル値を調査して、閾値を計算して返します。
     * @param i_reader
     * @param i_x
     * @param i_y
     * @return
     * @throws NyARException
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">detectThresholdValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_threshold</span>:<span class="ActionScriptDefault_Text">TThreshold</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th_pixels</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_th_pixels</span>;

        <span class="ActionScriptComment">//左上のピックアップ領域からピクセルを得る(00-24)
</span>        <span class="ActionScriptDefault_Text">rectPixels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">//左下のピックアップ領域からピクセルを得る(25-49)
</span>        <span class="ActionScriptDefault_Text">rectPixels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">//右上のピックアップ領域からピクセルを得る(50-74)
</span>        <span class="ActionScriptDefault_Text">rectPixels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptComment">//右下のピックアップ領域からピクセルを得る(75-99)
</span>        <span class="ActionScriptDefault_Text">rectPixels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">hl</span>:<span class="ActionScriptDefault_Text">THighAndLow</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__detectThresholdValue_hl</span>;
        <span class="ActionScriptComment">//Ptailで求めたピクセル平均
</span>        <span class="ActionScriptDefault_Text">getPtailHighAndLow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">hl</span><span class="ActionScriptBracket/Brace">)</span>;


        
        <span class="ActionScriptComment">//閾値中心
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hl</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">h</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">hl</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
        <span class="ActionScriptComment">//ヒステリシス(差分の20%)
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th_sub</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hl</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">h</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hl</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>5;
        
        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">th</span>;
        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_h</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">th_sub</span>;<span class="ActionScriptComment">//ヒステリシス付き閾値
</span>        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_l</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">th_sub</span>;<span class="ActionScriptComment">//ヒステリシス付き閾値
</span>
        <span class="ActionScriptComment">//エッジを計算(明点重心)
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lt_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lt_y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lb_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lb_y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">rt_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">rt_y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">rb_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">rb_y</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tpt</span>:<span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__detectThresholdValue_tpt</span>;
        <span class="ActionScriptComment">//LT
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getHighPixelCenter</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">lt_x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
            <span class="ActionScriptDefault_Text">lt_y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">lt_x</span><span class="ActionScriptOperator">=</span>11;
            <span class="ActionScriptDefault_Text">lt_y</span><span class="ActionScriptOperator">=</span>11;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//LB
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getHighPixelCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">*</span>1<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">lb_x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
            <span class="ActionScriptDefault_Text">lb_y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">lb_x</span><span class="ActionScriptOperator">=</span>11;
            <span class="ActionScriptDefault_Text">lb_y</span><span class="ActionScriptOperator">=</span>-1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//RT
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getHighPixelCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">rt_x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
            <span class="ActionScriptDefault_Text">rt_y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">rt_x</span><span class="ActionScriptOperator">=</span>-1;
            <span class="ActionScriptDefault_Text">rt_y</span><span class="ActionScriptOperator">=</span>11;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//RB
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getHighPixelCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th_pixels</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">THRESHOLD_PIXEL</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">rb_x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
            <span class="ActionScriptDefault_Text">rb_y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">tpt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">THRESHOLD_STEP</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">rb_x</span><span class="ActionScriptOperator">=</span>-1;
            <span class="ActionScriptDefault_Text">rb_y</span><span class="ActionScriptOperator">=</span>-1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//トラッキング開始位置の決定
</span>        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lt_x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lt_x</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">lb_x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span><span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rb_x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rt_x</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">rb_x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span><span class="ActionScriptOperator">+</span>1;
        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lt_y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lt_y</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">rt_y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_LT</span><span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptDefault_Text">o_threshold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rb_y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lb_y</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">rb_y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">THRESHOLD_SAMPLE_RB</span><span class="ActionScriptOperator">+</span>1;
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getHighPixelCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_st</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_pixels</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_width</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_height</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_point</span>:<span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rp</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_st</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos_x</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos_y</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">number_of_pos</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_height</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_width</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pixels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rp</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">pos_x</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">i2</span>;
                    <span class="ActionScriptDefault_Text">pos_y</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">i</span>;
                    <span class="ActionScriptDefault_Text">number_of_pos</span><span class="ActionScriptOperator">++</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">number_of_pos</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">pos_x</span><span class="ActionScriptOperator">/=</span><span class="ActionScriptDefault_Text">number_of_pos</span>;
            <span class="ActionScriptDefault_Text">pos_y</span><span class="ActionScriptOperator">/=</span><span class="ActionScriptDefault_Text">number_of_pos</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">o_point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos_x</span>;
        <span class="ActionScriptDefault_Text">o_point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos_y</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__detectDataBitsIndex_freq_index1</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__detectDataBitsIndex_freq_index2</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRQ_POINTS</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">detectDataBitsIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span>:<span class="ActionScriptDefault_Text">TThreshold</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_index_row</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_index_col</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptComment">//周波数を測定
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_index1</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__detectDataBitsIndex_freq_index1</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_index2</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__detectDataBitsIndex_freq_index2</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">frq_t</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getRowFrequency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lt_y</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_h</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_l</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_index1</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">frq_b</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getRowFrequency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rb_y</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_h</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_l</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_index2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//周波数はまとも？
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">frq_t</span><span class="ActionScriptOperator">&lt;</span>0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">frq_b</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">frq_t</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">frq_b</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//タイミングパターンからインデクスを作成
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">freq_h</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_v</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">frq_t</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">frq_b</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_h</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">frq_t</span>;
            <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">freq_index1</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_h</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">frq_b</span>;
            <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">freq_index2</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">freq_h</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">freq_h</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">o_index_row</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">/</span>5<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span>;
            <span class="ActionScriptDefault_Text">o_index_row</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">/</span>5<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span>;
        <span class="ActionScriptBracket/Brace">}</span>        
        
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">frq_l</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getColFrequency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lt_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_h</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_l</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_index1</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">frq_r</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getColFrequency</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rb_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_h</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th_l</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">freq_index2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//周波数はまとも？
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">frq_l</span><span class="ActionScriptOperator">&lt;</span>0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">frq_r</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">frq_l</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">frq_r</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//タイミングパターンからインデクスを作成
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">frq_l</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">frq_r</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">frq_l</span>;
            <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">freq_index1</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">freq_v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">frq_r</span>;
            <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">freq_index2</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//同じ周期？
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_v</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">freq_h</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">freq_v</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">freq_v</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w2</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">w</span>;
            <span class="ActionScriptDefault_Text">o_index_col</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">/</span>5<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">w</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span>;
            <span class="ActionScriptDefault_Text">o_index_col</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">/</span>5<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">w</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">FRQ_EDGE</span>;
        <span class="ActionScriptBracket/Brace">}</span>        
        <span class="ActionScriptComment">//Lv4以上は無理
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">freq_v</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">MAX_FREQ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">freq_v</span>;
        
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__readDataBits_index_bit_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MAX_DATA_BITS</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__readDataBits_index_bit_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MAX_DATA_BITS</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span>;
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readDataBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span>:<span class="ActionScriptDefault_Text">INyARRgbPixelReader</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_raster_size</span>:<span class="ActionScriptDefault_Text">NyARIntSize</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">i_th</span>:<span class="ActionScriptDefault_Text">TThreshold</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">o_bitbuffer</span>:<span class="ActionScriptDefault_Text">MarkerPattEncoder</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__readDataBits_index_bit_x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">__readDataBits_index_bit_y</span>;
        

        <span class="ActionScriptComment">//読み出し位置を取得
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">size</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">detectDataBitsIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_raster_size</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">index_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">index_y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">resolution</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">size</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">size</span><span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">size</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">o_bitbuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">initEncoder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">size</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>        
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_cparam</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_x</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref_y</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ref_y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pixcel_temp</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pixcel_temp</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_3</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpara_6</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;
        
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">th</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">resolution</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptComment">//1列分のピクセルのインデックス値を計算する。
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">index_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">index_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>;            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_12</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_45</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy0_7</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy0</span><span class="ActionScriptOperator">+</span>1.0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy1_12</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy1_45</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpy1_7</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cy1</span><span class="ActionScriptOperator">+</span>1.0;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">resolution</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>            

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">index_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">index_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp6_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_6</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpx0_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_0</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpx3_0</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_3</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx0</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp6_1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_6</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx1</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpx0_1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_0</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx1</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cpx3_1</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cpara_3</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">cx1</span>;
                
                <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cp6_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_7</span>;
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx0_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx3_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_45</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;

                <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cp6_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy1_7</span>;
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx0_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy1_12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx3_0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy1_45</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;

                <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cp6_1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_7</span>;
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx0_1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx3_1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy0_45</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;

                <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">cp6_1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy1_7</span>;
                <span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx0_1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy1_12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cpx3_1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cpy1_45</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//1行分のピクセルを取得(場合によっては専用アクセサを書いた方がいい)
</span>            <span class="ActionScriptDefault_Text">i_reader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixelSet</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref_x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ref_y</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">resolution</span><span class="ActionScriptOperator">*</span>4<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//グレースケールにしながら、line→mapへの転写
</span>            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">resolution</span>;<span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">*</span>4;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pixel</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span>    <span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>6<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>8<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span>
                            <span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>9<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>10<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">pixcel_temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>11<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span>4<span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//暗点を1、明点を0で表現します。
</span>                <span class="ActionScriptDefault_Text">o_bitbuffer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setBitByBitIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">pixel</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">th</span><span class="ActionScriptOperator">?</span>0:1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptComment">/*        
        for(int i=0;i&lt;225*4;i++){
            this.vertex_x[i]=0;
            this.vertex_y[i]=0;
        }
        for(int i=0;i&lt;(resolution)*2;i++){
            for(int i2=0;i2&lt;(resolution)*2;i2++){
                this.vertex_x[i*(resolution)*2+i2]=(int)index_x[i2];
                this.vertex_y[i*(resolution)*2+i2]=(int)index_y[i];
                
            }
        }
*/</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setSquare</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_vertex</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">NyARIntPoint2d</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_param_gen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_vertex</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_cparam</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MarkerPattDecoder</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">decode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">domain</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">mask</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptASDoc">/**
 * マーカパターンのエンコーダです。
 *
 */</span>
<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MarkerPattEncoder</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">_bit_table_3</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
        25<span class="ActionScriptOperator">,</span>    26<span class="ActionScriptOperator">,</span>    27<span class="ActionScriptOperator">,</span>    28<span class="ActionScriptOperator">,</span>    29<span class="ActionScriptOperator">,</span>    30<span class="ActionScriptOperator">,</span>    31<span class="ActionScriptOperator">,</span>
        48<span class="ActionScriptOperator">,</span>    9<span class="ActionScriptOperator">,</span>    10<span class="ActionScriptOperator">,</span>    11<span class="ActionScriptOperator">,</span>    12<span class="ActionScriptOperator">,</span>    13<span class="ActionScriptOperator">,</span>    32<span class="ActionScriptOperator">,</span>
        47<span class="ActionScriptOperator">,</span>    24<span class="ActionScriptOperator">,</span>    1<span class="ActionScriptOperator">,</span>    2<span class="ActionScriptOperator">,</span>    3<span class="ActionScriptOperator">,</span>    14<span class="ActionScriptOperator">,</span>    33<span class="ActionScriptOperator">,</span>
        46<span class="ActionScriptOperator">,</span>    23<span class="ActionScriptOperator">,</span>    8<span class="ActionScriptOperator">,</span>    0<span class="ActionScriptOperator">,</span>    4<span class="ActionScriptOperator">,</span>    15<span class="ActionScriptOperator">,</span>    34<span class="ActionScriptOperator">,</span>
        45<span class="ActionScriptOperator">,</span>    22<span class="ActionScriptOperator">,</span>    7<span class="ActionScriptOperator">,</span>    6<span class="ActionScriptOperator">,</span>    5<span class="ActionScriptOperator">,</span>    16<span class="ActionScriptOperator">,</span>    35<span class="ActionScriptOperator">,</span>
        44<span class="ActionScriptOperator">,</span>    21<span class="ActionScriptOperator">,</span>    20<span class="ActionScriptOperator">,</span>    19<span class="ActionScriptOperator">,</span>    18<span class="ActionScriptOperator">,</span>    17<span class="ActionScriptOperator">,</span>    36<span class="ActionScriptOperator">,</span>
        43<span class="ActionScriptOperator">,</span>    42<span class="ActionScriptOperator">,</span>    41<span class="ActionScriptOperator">,</span>    40<span class="ActionScriptOperator">,</span>    39<span class="ActionScriptOperator">,</span>    38<span class="ActionScriptOperator">,</span>    37
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">_bit_table_2</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
        9<span class="ActionScriptOperator">,</span>    10<span class="ActionScriptOperator">,</span>    11<span class="ActionScriptOperator">,</span>    12<span class="ActionScriptOperator">,</span>    13<span class="ActionScriptOperator">,</span>
        24<span class="ActionScriptOperator">,</span>    1<span class="ActionScriptOperator">,</span>    2<span class="ActionScriptOperator">,</span>    3<span class="ActionScriptOperator">,</span>    14<span class="ActionScriptOperator">,</span>
        23<span class="ActionScriptOperator">,</span>    8<span class="ActionScriptOperator">,</span>    0<span class="ActionScriptOperator">,</span>    4<span class="ActionScriptOperator">,</span>    15<span class="ActionScriptOperator">,</span>
        22<span class="ActionScriptOperator">,</span>    7<span class="ActionScriptOperator">,</span>    6<span class="ActionScriptOperator">,</span>    5<span class="ActionScriptOperator">,</span>    16<span class="ActionScriptOperator">,</span>
        21<span class="ActionScriptOperator">,</span>    20<span class="ActionScriptOperator">,</span>    19<span class="ActionScriptOperator">,</span>    18<span class="ActionScriptOperator">,</span>    17<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">_bit_tables</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span>
        <span class="ActionScriptDefault_Text">_bit_table_2</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_bit_table_3</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptASDoc">/**
     * RECT(0):[0]=(0)
     * RECT(1):[1]=(1-8)
     * RECT(2):[2]=(9-16),[3]=(17-24)
     * RECT(3):[4]=(25-32),[5]=(33-40),[6]=(41-48)
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bit_table</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bits</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_work</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_model</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setBitByBitIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_index_no</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_value</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">NyAS3Utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_value</span><span class="ActionScriptOperator">==</span>0 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">i_value</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bit_no</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bit_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i_index_no</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bit_no</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_value</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bidx</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bit_no</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>8<span class="ActionScriptOperator">+</span>1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sidx</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bit_no</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span>8;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bidx</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bidx</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&amp;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">~</span><span class="ActionScriptBracket/Brace">(</span>0x01<span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sidx</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_value</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sidx</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setBit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_value</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">NyAS3Utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_value</span><span class="ActionScriptOperator">==</span>0 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">i_value</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_value</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bidx</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>8<span class="ActionScriptOperator">+</span>1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sidx</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span>8;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bidx</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bidx</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&amp;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">~</span><span class="ActionScriptBracket/Brace">(</span>0x01<span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sidx</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_value</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sidx</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getBit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bidx</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>8<span class="ActionScriptOperator">+</span>1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sidx</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_bit_no</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span>8;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bidx</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sidx</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span><span class="ActionScriptBracket/Brace">(</span>0x01<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getModel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getControlValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_model</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_data</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_model</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">case</span> 2:
            <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_data</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x0e<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>1;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">&gt;=</span>5<span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">-</span>1:<span class="ActionScriptDefault_Text">v</span>;
        <span class="ActionScriptReserved">case</span> 3:
            <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_data</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x3e<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>1;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">&gt;=</span>21<span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">-</span>1:<span class="ActionScriptDefault_Text">v</span>;
        <span class="ActionScriptReserved">case</span> 4:
        <span class="ActionScriptReserved">case</span> 5:
        <span class="ActionScriptReserved">case</span> 6:
        <span class="ActionScriptReserved">case</span> 7:
        <span class="ActionScriptReserved">default</span>:
            <span class="ActionScriptReserved">break</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCheckValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_model</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_data</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_model</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">case</span> 2:
            <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_data</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0xe0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>5;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">&gt;</span>5<span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">-</span>1:<span class="ActionScriptDefault_Text">v</span>;
        <span class="ActionScriptReserved">case</span> 3:
            <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_data</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x80<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>7<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_data</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x0f<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;&lt;</span>1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">&gt;</span>21<span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">-</span>1:<span class="ActionScriptDefault_Text">v</span>;
        <span class="ActionScriptReserved">case</span> 4:
        <span class="ActionScriptReserved">case</span> 5:
        <span class="ActionScriptReserved">case</span> 6:
        <span class="ActionScriptReserved">case</span> 7:
        <span class="ActionScriptReserved">default</span>:
            <span class="ActionScriptReserved">break</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initEncoder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_model</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_model</span><span class="ActionScriptOperator">&gt;</span>3 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">i_model</span><span class="ActionScriptOperator">&lt;</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//Lv4以降に対応する時は、この制限を変える。
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bit_table</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_bit_tables</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i_model</span><span class="ActionScriptOperator">-</span>2<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_model</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getDirection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">l</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">t</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">r</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">b</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">timing_pat</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">case</span> 2:
            <span class="ActionScriptComment">//トラッキングセルを得る
</span>            <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x1f;
            <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0xf0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>4<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&amp;</span>0x01<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;&lt;</span>4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x1f;
            <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0xf0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>4<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&amp;</span>0x01<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;&lt;</span>4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptOperator">=</span>0x0a;
            <span class="ActionScriptReserved">break</span>;
        <span class="ActionScriptReserved">case</span> 3:
            <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x7f;
            <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0xc0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>6<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x1f<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;&lt;</span>2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0xf0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>4<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x07<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;&lt;</span>4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0xfc<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;&gt;</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&amp;</span> 0x01<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;&lt;</span>6<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptOperator">=</span>0x2a;
            <span class="ActionScriptReserved">break</span>;
        <span class="ActionScriptReserved">default</span>:
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>3;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//タイミングパターンの比較
</span>        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span>2:<span class="ActionScriptOperator">-</span>2;
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span>3:<span class="ActionScriptOperator">-</span>2;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span>1:<span class="ActionScriptOperator">-</span>2;
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptDefault_Text">timing_pat</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span>0:<span class="ActionScriptOperator">-</span>2;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
     * 格納しているマーカパターンをエンコードして、マーカデータを返します。
     * @param o_out
     * @return
     * 成功すればマーカの方位を返却します。失敗すると-1を返します。
     */</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">encode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">o_out</span>:<span class="ActionScriptDefault_Text">NyIdMarkerPattern</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getDirection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">&lt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//回転ビットの取得
</span>        <span class="ActionScriptDefault_Text">getRotatedBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">model</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span>;
        <span class="ActionScriptComment">//周辺ビットの取得
</span>        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">model</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">control_bits</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getControlValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">check</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getCheckValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">model</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ctrl_mask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">control_bits</span><span class="ActionScriptOperator">%</span>5;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ctrl_domain</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">control_bits</span><span class="ActionScriptOperator">/</span>5;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ctrl_domain</span><span class="ActionScriptOperator">!=</span>0 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ctrl_mask</span><span class="ActionScriptOperator">!=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;<span class="ActionScriptComment">//ドメイン、マスクは現在0のみなので、それ以外の場合-1（失敗）を返す
</span>        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//マスク解除処理を実装すること
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">d</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getRotatedBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_direction</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">o_out</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sl</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_direction</span><span class="ActionScriptOperator">*</span>2;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sr</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>8<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sl</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w1</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptComment">//RECT1
</span>        <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sl</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&gt;&gt;</span><span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span> 0xff;
        
        <span class="ActionScriptComment">//RECT2
</span>        <span class="ActionScriptDefault_Text">sl</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_direction</span><span class="ActionScriptOperator">*</span>4;
        <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">=</span>16<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sl</span>;
        <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;&lt;</span>8<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sl</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&gt;&gt;</span><span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">&amp;</span> 0xff;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&gt;&gt;</span>8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 0xff;

        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span><span class="ActionScriptOperator">&lt;</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">//RECT3
</span>        <span class="ActionScriptDefault_Text">sl</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_direction</span><span class="ActionScriptOperator">*</span>6;
        <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">=</span>24<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">sl</span>;            
        <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;&lt;</span>8<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_bits</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;&lt;</span>16<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">sl</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&gt;&gt;</span><span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">&amp;</span> 0xff;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&gt;&gt;</span>8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 0xff;
        <span class="ActionScriptDefault_Text">o_out</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">&gt;&gt;</span>16<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 0xff;
        
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_model</span><span class="ActionScriptOperator">&lt;</span>3<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//RECT4(Lv4以降はここの制限を変える)
</span><span class="ActionScriptComment">//        shiftLeft(this._bits,7,3,i_direction*8);
</span><span class="ActionScriptComment">//        if(this._model&lt;4){
</span><span class="ActionScriptComment">//            return;
</span><span class="ActionScriptComment">//        }
</span>        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">shiftLeft</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pack</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_start</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_length</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">i_ls</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">work</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_work</span>;
        <span class="ActionScriptComment">//端数シフト
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mod_shift</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_ls</span><span class="ActionScriptOperator">%</span>8;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_length</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">work</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pack</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_start</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">mod_shift</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span>0xff<span class="ActionScriptOperator">&amp;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pack</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_start</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;&gt;</span><span class="ActionScriptBracket/Brace">(</span>8<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mod_shift</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">work</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pack</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i_start</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;&lt;</span><span class="ActionScriptDefault_Text">mod_shift</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">|</span><span class="ActionScriptBracket/Brace">(</span>0xff<span class="ActionScriptOperator">&amp;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pack</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i_start</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;&gt;</span><span class="ActionScriptBracket/Brace">(</span>8<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">mod_shift</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//バイトシフト
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">byte_shift</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_ls</span><span class="ActionScriptOperator">/</span>8<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span><span class="ActionScriptDefault_Text">i_length</span>;
        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_length</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">i_pack</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">byte_shift</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">%</span><span class="ActionScriptDefault_Text">i_length</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_start</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span>0xff <span class="ActionScriptOperator">&amp;</span> <span class="ActionScriptDefault_Text">work</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>    
<span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">TThreshold</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th_h</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th_l</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">th</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lt_x</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lt_y</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rb_x</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rb_y</span>:<span class="ActionScriptDefault_Text">int</span>;
<span class="ActionScriptBracket/Brace">}</span>



<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">THighAndLow</span><span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">h</span>:<span class="ActionScriptDefault_Text">int</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">l</span>:<span class="ActionScriptDefault_Text">int</span>;
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
